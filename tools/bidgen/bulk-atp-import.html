<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATP Bulk Data Import</title>
    <meta name="robots" content="noindex, nofollow">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a2e; color: #eee; min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 30px 20px; }
        h1 { font-size: 28px; margin-bottom: 4px; color: #e8e8e8; }
        .subtitle { color: #7f8c8d; font-size: 14px; margin-bottom: 30px; }
        
        .card { background: #16213e; border: 1px solid #2a3a5c; border-radius: 10px; padding: 24px; margin-bottom: 20px; }
        .card h2 { font-size: 16px; color: #3498db; margin-bottom: 16px; text-transform: uppercase; letter-spacing: 1px; display: flex; align-items: center; gap: 8px; }
        .card h2 .icon { width: 28px; height: 28px; background: #3498db; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; }
        
        .upload-zone { border: 2px dashed #3a4a5c; border-radius: 10px; padding: 40px; text-align: center; margin-bottom: 20px; transition: all 0.3s; }
        .upload-zone:hover { border-color: #3498db; background: #0f1a33; }
        .upload-zone.dragover { border-color: #27ae60; background: #0a2818; }
        
        .file-input-wrapper { position: relative; display: inline-block; }
        .file-input-wrapper input[type=file] { position: absolute; left: -9999px; }
        .file-input-label { display: inline-block; padding: 12px 24px; background: #3498db; color: white; border-radius: 6px; cursor: pointer; transition: all 0.2s; }
        .file-input-label:hover { background: #2980b9; }
        
        .btn { padding: 14px 28px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: #3498db; color: white; }
        .btn-primary:hover { background: #2980b9; }
        .btn-success { background: #27ae60; color: white; }
        .btn-success:hover { background: #2ecc71; }
        .btn-warning { background: #f39c12; color: white; }
        .btn-warning:hover { background: #e67e22; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-danger:hover { background: #c0392b; }
        
        .file-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; margin-top: 20px; }
        .file-card { background: #0f1a33; border: 1px solid #2a3a5c; border-radius: 8px; padding: 15px; }
        .file-name { font-weight: 600; color: #3498db; margin-bottom: 8px; word-break: break-all; }
        .file-info { font-size: 12px; color: #7f8c8d; margin-bottom: 10px; }
        .file-status { display: inline-block; padding: 3px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; text-transform: uppercase; }
        .status-pending { background: #7f8c8d; color: white; }
        .status-processing { background: #f39c12; color: white; }
        .status-success { background: #27ae60; color: white; }
        .status-error { background: #e74c3c; color: white; }
        
        .progress-bar { width: 100%; height: 8px; background: #2a3a5c; border-radius: 4px; overflow: hidden; margin-top: 10px; }
        .progress-fill { height: 100%; background: #3498db; transition: width 0.3s; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
        .stat-box { text-align: center; padding: 20px; background: #0f1a33; border-radius: 8px; border: 1px solid #2a3a5c; }
        .stat-value { font-size: 24px; font-weight: 700; color: #3498db; margin-bottom: 5px; }
        .stat-label { font-size: 11px; color: #7f8c8d; text-transform: uppercase; letter-spacing: 0.5px; }
        
        .quick-scan { background: linear-gradient(135deg, #1a2744, #0f1a33); border: 1px solid #3498db; border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        .quick-scan h3 { color: #3498db; margin-bottom: 15px; }
        .scan-results { max-height: 200px; overflow-y: auto; }
        .scan-item { padding: 8px 12px; margin-bottom: 5px; background: #0f1a33; border-radius: 6px; font-size: 12px; display: flex; justify-content: space-between; align-items: center; }
        .scan-item.atp { border-left: 3px solid #e67e22; }
        .scan-item.other { border-left: 3px solid #27ae60; }
    </style>
</head>
<body>

<div class="container">
    <h1>ATP Bulk Data Import</h1>
    <p class="subtitle">Quickly import all ATP-related documents to build your competitive intelligence database</p>

    <!-- QUICK SCAN -->
    <div class="quick-scan">
        <h3>üîç Quick Scan: Found ATP Files</h3>
        <div class="scan-results" id="scanResults">
            <!-- Scanned files will appear here -->
        </div>
        <button class="btn btn-primary" onclick="importScannedFiles()" style="margin-top: 15px;">üì• Import All Scanned Files</button>
    </div>

    <!-- BULK UPLOAD -->
    <div class="card">
        <h2><span class="icon">üìÅ</span> Bulk File Upload</h2>
        <div class="upload-zone" id="bulkUploadZone">
            <h3>Drop ATP files here or click to browse</h3>
            <p>Supports PDF, DOC, DOCX, TXT, CSV files - Multiple files allowed</p>
            <div class="file-input-wrapper">
                <input type="file" id="bulkFileInput" accept=".pdf,.doc,.docx,.txt,.csv" multiple>
                <label for="bulkFileInput" class="file-input-label">Choose ATP Files</label>
            </div>
        </div>
        <div style="margin-top: 20px;">
            <button class="btn btn-success" onclick="processAllFiles()">üöÄ Process All Files</button>
            <button class="btn btn-warning" onclick="clearFiles()">üóëÔ∏è Clear All</button>
            <button class="btn btn-primary" onclick="exportResults()">üìä Export Results</button>
        </div>
    </div>

    <!-- FILE GRID -->
    <div class="card">
        <h2><span class="icon">üìã</span> File Queue</h2>
        <div class="file-grid" id="fileGrid">
            <!-- Files will appear here -->
        </div>
    </div>

    <!-- STATISTICS -->
    <div class="card">
        <h2><span class="icon">üìà</span> Import Statistics</h2>
        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-value" id="totalFiles">0</div>
                <div class="stat-label">Total Files</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="atpFiles">0</div>
                <div class="stat-label">ATP Files</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="processedFiles">0</div>
                <div class="stat-label">Processed</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="extractedBids">0</div>
                <div class="stat-label">Bids Extracted</div>
            </div>
        </div>
    </div>

    <!-- PROGRESS -->
    <div class="card" id="progressCard" style="display: none;">
        <h2><span class="icon">‚ö°</span> Processing Progress</h2>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>
        <div style="margin-top: 10px; font-size: 12px; color: #7f8c8d;">
            <span id="progressText">0 / 0 files processed</span>
        </div>
    </div>
</div>

<script>
// Global variables
let uploadedFiles = [];
let processedData = [];
let atpFilePatterns = [
    'atp', 'watts', 'justin watts', 'wsi', 'watts safety', 'bid', 'quote', 'estimate', 
    'contract', 'proposal', 'north park', 'allen', 'smith', 'kent', 'esperanza', 'pleasant'
];

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    setupBulkUpload();
    quickScanDownloads();
});

function setupBulkUpload() {
    const uploadZone = document.getElementById('bulkUploadZone');
    const fileInput = document.getElementById('bulkFileInput');
    
    uploadZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadZone.classList.add('dragover');
    });
    
    uploadZone.addEventListener('dragleave', () => {
        uploadZone.classList.remove('dragover');
    });
    
    uploadZone.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadZone.classList.remove('dragover');
        handleBulkFiles(e.dataTransfer.files);
    });
    
    fileInput.addEventListener('change', (e) => {
        handleBulkFiles(e.target.files);
    });
}

function quickScanDownloads() {
    // Simulate scanning Downloads folder for ATP files
    const foundFiles = [
        'ATP-Material-Funding-Auth-Docs-2026-2.0.pdf',
        'ATP-Material-Funding-Auth-Docs-2026.pdf',
        'Allen_Quote_Form- Bathroom_rev_ATP-25 11.20.pdf',
        'Allen_Quote_Form- Bathroom_rev_ATP-25 2.0 11.20.pdf',
        'Atp-Materials-Jayne-Allen-2026.pdf',
        'EsperanzaBathroomQuoteForm-Complete_WSI-26.pdf',
        'Justin Watts NorthPark EST#12539.pdf',
        'K_12_25_Smith_Bathroom.pdf',
        'North Park FInal Quote-2026.pdf',
        'PleasantQuote_Form- Bath_Complete-2026.pdf',
        'atp-quote-misc-2025_pdf.pdf',
        'wattssafetyinstalls_estimate_1.pdf',
        'WSI-internal_all-2025 - 1 - Internal - All.csv',
        'My Applicants - Watts Safety Installs - 10_16_2025.csv'
    ];
    
    const scanResults = document.getElementById('scanResults');
    scanResults.innerHTML = foundFiles.map(file => {
        const isAtp = atpFilePatterns.some(pattern => file.toLowerCase().includes(pattern));
        return `
            <div class="scan-item ${isAtp ? 'atp' : 'other'}">
                <span>${file}</span>
                <span class="file-status ${isAtp ? 'status-pending' : 'status-success'}">
                    ${isAtp ? 'ATP' : 'OTHER'}
                </span>
            </div>
        `;
    }).join('');
    
    updateStats(foundFiles.length, foundFiles.filter(f => 
        atpFilePatterns.some(p => f.toLowerCase().includes(p))
    ).length);
}

function handleBulkFiles(files) {
    Array.from(files).forEach(file => {
        const fileData = {
            file: file,
            name: file.name,
            size: file.size,
            type: file.type,
            status: 'pending',
            isAtp: atpFilePatterns.some(pattern => file.name.toLowerCase().includes(pattern)),
            extractedData: null
        };
        
        uploadedFiles.push(fileData);
        addFileToGrid(fileData);
    });
    
    updateStats();
}

function addFileToGrid(fileData) {
    const fileGrid = document.getElementById('fileGrid');
    
    const fileCard = document.createElement('div');
    fileCard.className = 'file-card';
    fileCard.id = `file-${fileData.name.replace(/[^a-zA-Z0-9]/g, '-')}`;
    
    fileCard.innerHTML = `
        <div class="file-name">${fileData.name}</div>
        <div class="file-info">
            Size: ${(fileData.size / 1024).toFixed(1)} KB | 
            Type: ${fileData.type || 'Unknown'} | 
            ${fileData.isAtp ? 'üè¢ ATP File' : 'üìÑ Other'}
        </div>
        <div class="file-status status-${fileData.status}" id="status-${fileData.name.replace(/[^a-zA-Z0-9]/g, '-')}">
            ${fileData.status.toUpperCase()}
        </div>
        <div class="progress-bar" style="display: none;" id="progress-${fileData.name.replace(/[^a-zA-Z0-9]/g, '-')}">
            <div class="progress-fill" style="width: 0%;"></div>
        </div>
    `;
    
    fileGrid.appendChild(fileCard);
}

async function processAllFiles() {
    const progressCard = document.getElementById('progressCard');
    progressCard.style.display = 'block';
    
    let processed = 0;
    const total = uploadedFiles.length;
    
    for (const fileData of uploadedFiles) {
        await processFile(fileData);
        processed++;
        updateProgress(processed, total);
    }
    
    // Show completion
    setTimeout(() => {
        alert(`Processing complete! Extracted ${processedData.length} bids from ${total} files.`);
        progressCard.style.display = 'none';
    }, 1000);
}

async function processFile(fileData) {
    updateFileStatus(fileData.name, 'processing');
    
    try {
        const content = await readFileContent(fileData.file);
        const extractedData = extractBidData(content, fileData.name);
        
        fileData.extractedData = extractedData;
        fileData.status = extractedData ? 'success' : 'error';
        
        if (extractedData) {
            processedData.push(extractedData);
        }
        
        updateFileStatus(fileData.name, fileData.status);
        
    } catch (error) {
        console.error('Error processing file:', fileData.name, error);
        fileData.status = 'error';
        updateFileStatus(fileData.name, 'error');
    }
}

function readFileContent(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = (e) => resolve(e.target.result);
        reader.onerror = reject;
        reader.readAsText(file);
    });
}

function extractBidData(content, filename) {
    // Simple bid extraction logic
    const bidData = {
        filename: filename,
        date: new Date().toISOString(),
        totalAmount: 0,
        won: false,
        competitors: [],
        projectType: 'unknown',
        wattsEntity: null,
        knownCompetitors: false
    };
    
    const lines = content.split('\n');
    const wattsEntities = ['watts atp contractor', 'watts safety installs', 'wsi', 'watts', 'justin watts'];
    
    lines.forEach(line => {
        // Extract monetary values
        const amountMatches = line.match(/\$?([\d,]+\.?\d*)/g);
        if (amountMatches) {
            amountMatches.forEach(match => {
                const amount = parseFloat(match.replace(/[$,]/g, ''));
                if (amount > bidData.totalAmount && amount < 100000) {
                    bidData.totalAmount = amount;
                }
            });
        }
        
        // Check for Watts entities
        wattsEntities.forEach(entity => {
            if (line.toLowerCase().includes(entity)) {
                bidData.wattsEntity = entity;
                if (line.toLowerCase().match(/\b(won|win|awarded|successful|selected|chosen)\b/)) {
                    bidData.won = true;
                }
            }
        });
        
        // Look for competitors
        const competitorMatch = line.match(/([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*(?:\s+(?:Contracting|Contractors|Construction|Co|Company|Inc|LLC)))\b/);
        if (competitorMatch) {
            const name = competitorMatch[1];
            const isWatts = wattsEntities.some(entity => name.toLowerCase().includes(entity));
            if (!isWatts && name.length > 2) {
                bidData.competitors.push({ name, bid: 0 });
                bidData.knownCompetitors = true;
            }
        }
    });
    
    return bidData.totalAmount > 0 ? bidData : null;
}

function updateFileStatus(filename, status) {
    const statusElement = document.getElementById(`status-${filename.replace(/[^a-zA-Z0-9]/g, '-')}`);
    if (statusElement) {
        statusElement.className = `file-status status-${status}`;
        statusElement.textContent = status.toUpperCase();
    }
}

function updateProgress(processed, total) {
    const percentage = (processed / total) * 100;
    document.getElementById('progressFill').style.width = percentage + '%';
    document.getElementById('progressText').textContent = `${processed} / ${total} files processed`;
    
    document.getElementById('processedFiles').textContent = processed;
    document.getElementById('extractedBids').textContent = processedData.length;
}

function updateStats(total = null, atp = null) {
    if (total !== null) {
        document.getElementById('totalFiles').textContent = total;
    } else {
        document.getElementById('totalFiles').textContent = uploadedFiles.length;
    }
    
    if (atp !== null) {
        document.getElementById('atpFiles').textContent = atp;
    } else {
        document.getElementById('atpFiles').textContent = uploadedFiles.filter(f => f.isAtp).length;
    }
    
    document.getElementById('processedFiles').textContent = uploadedFiles.filter(f => f.status === 'success').length;
    document.getElementById('extractedBids').textContent = processedData.length;
}

function clearFiles() {
    uploadedFiles = [];
    processedData = [];
    document.getElementById('fileGrid').innerHTML = '';
    updateStats();
    document.getElementById('progressCard').style.display = 'none';
}

function exportResults() {
    if (processedData.length === 0) {
        alert('No data to export!');
        return;
    }
    
    const csvContent = 'data:text/csv;charset=utf-8,' + 
        'Filename,Amount,Won,Competitors,Project Type,Watts Entity\n' +
        processedData.map(bid => 
            `"${bid.filename}",${bid.totalAmount},${bid.won},"${bid.competitors.map(c => c.name).join(';')}","${bid.projectType}","${bid.wattsEntity || ''}"`
        ).join('\n');
    
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement('a');
    link.setAttribute('href', encodedUri);
    link.setAttribute('download', `atp-bid-data-${new Date().toISOString().split('T')[0]}.csv`);
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

function importScannedFiles() {
    // Simulate importing the scanned files
    const scannedFiles = [
        'ATP-Material-Funding-Auth-Docs-2026-2.0.pdf',
        'Allen_Quote_Form- Bathroom_rev_ATP-25 11.20.pdf',
        'Justin Watts NorthPark EST#12539.pdf',
        'North Park FInal Quote-2026.pdf',
        'atp-quote-misc-2025_pdf.pdf',
        'wattssafetyinstalls_estimate_1.pdf'
    ];
    
    alert(`Found ${scannedFiles.length} ATP files to import! In a real implementation, these would be automatically processed from your Downloads folder.`);
    
    // Add to file grid for demo
    scannedFiles.forEach(filename => {
        const fileData = {
            file: { name: filename, size: 1000000 },
            name: filename,
            size: 1000000,
            type: 'application/pdf',
            status: 'pending',
            isAtp: true,
            extractedData: null
        };
        uploadedFiles.push(fileData);
        addFileToGrid(fileData);
    });
    
    updateStats();
}
</script>

</body>
</html>
